%!TEX root = JakubJedryszek-MasterThesis.tex

\cleardoublepage

\chapter{Introduction}
\label{introduction}

Software is present in all aspects of our lives, from the simple program in alarm clocks to iPads, through cars, refrigerators and computers. Furthermore, our lives are getting more and more dependent on software. Usually when we think about software, we think about applications for PC or smart phone, e.g. calculator, word processor or stock market application. In this case, rapid development and smooth operation is a key. However, there is also another, very important class of software: safety-critical systems. It comprises of software for airplanes, medical devices, satellites or rockets.

Software Engineering for real-time and safety-critical systems is very different than creating business applications. In both types of software we want to ensure correctness and security. However, in each of them, to a different extent. In the case of the aforementioned word processor, software assurance is not critical. When it crashes, it can be restarted. In worst case scenario, some part of work might be lost. Airplane software crashes may put human lives in danger or even cause death. Thus for safety-critical systems, the security and correctness are crucial. Behind these reasons, different software design methodology, different properties of programming language and its tools are needed.

The most important part of safety-critical systems design is hazard analysis, which is how to avoid unintentional states and how to recover from them. Hazards can cause incidents or accidents. The former is an event that does not cause a loss but is undesired and could lead to an accident. The latter causes the loss, and it is also undesired. Hazard analysis can be done manually by humans or automatically by software tools. Software verification can detect hazards by discovering all possible program states and execution paths.


\section{Motivation}
\label{introduction:motivation}

Nowadays, medical devices work rather independently. This leads to many accidents, which could have been avoided by their interoperability. For example a drug (e.g. morphine) delivered by the patient-controlled analgesia (PCA) pump after surgery can cause a low oxygen level or even lack of pulse. That can lead to patient's death. The PCA pump does not monitor an oxygen level, but oxygen monitoring device does. If these two devices are organized in centralized system, which implements safety interlock mechanism to shutdown the pump when low oxygen level is detected, accident can be avoided. 

In order to communicate, devices have to use compatible interfaces and protocols. There is a concept of "Integrated Clinical Environment" (ICE). It is series of standards, which describe medical device integration and interoperability. The "Laboratory for Specification, Analysis, and Transformation of Software" (SAnToS) created "Medical Device Coordination Framework" (MDCF), which is prototype implementation of ICE. Standards are captured not only as requirement documents, but also as software and hardware models. It allows different medical devices, created by different vendors, to be connected and work under supervision of a centralized system.

The model-driven development approach proposed in this thesis is a response for the need to create code from models. The PCA pump prototype created in this thesis is as an example of a medical device, which ultimately will work under MDCF.


\section{Technologies}
\label{introduction:technologies}

AADL (Architecture Analysis \& Design Language) is a modeling language for representing hardware and software. It is used for real-time, safety critical and embedded systems. AADL allows for the description of both software and hardware parts of a system. It is used to describe architecture, but AADL allows to add behavioral extensions through annex languages. BLESS (Behavior Language for Embedded Systems with Software) is an AADL annex sub language defining behavior of components. The goal of BLESS is to automatically check the correctness of AADL models.

Ada is one of the most popular programming languages (along with C/C++) targeted at embedded and real-time systems. SPARK Ada is a subset of Ada, designed for the development of safety and security critical systems. It contains subset, which allows to reason about and prove correctness of programs and their entities. There are also SPARK tools for software verification.

\section{Goals}
\label{introduction:goals}
The initial goals of this research, which most of them are accomplished, are as follows:
\begin{itemize}
	\item Identify PCA pump and Infusion pumps properties and internals required for implementation.
	\item Investigate SPARK Ada cross-compilation for ARM-device (BeagleBoard-xM).
	\item Implement PCA Pump based on Brian Larson's Requirement Document \cite{OpenSourcePCAPump:Paper}.
	\item Develop AADL/BLESS to SPARK Ada mapping.
	\item Translate PCA pump AADL/BLESS models to SPARK Ada (based on created mapping and implementation).
	\item Propose requirements and design for AADL/BLESS to SPARK Ada translator.
	\item Use SPARK tool set for software verification:
		\begin{itemize}
			\item SPARK Examiner
			\item SPARKSimp
			\item Proof Obligation Summarizer (POGS)
			\item Bakar Kiasan
			\item GNATprove
		\end{itemize}
\end{itemize}


\section{Contribution}
\label{introduction:contribution}
This thesis demonstrates mapping of AADL/BLESS models to code in SPARK Ada. Additionally it presents current possibilities and limitations of SPARK Ada language, Ravenscar profile and SPARK verification tools. The main contributions of this thesis are as follows:
\begin{itemize}
	\item Review of "Integrated Clinical Environment Patient-Controlled Analgesia Infusion Pump System Requirements" \cite{PcaReq}.
	\item Cross-compilation and testing of SPARK Ada 2005 and 2014 programs on BeagleBoard-xM platform.
	\item Implementation of PCA pump based on Requirements Document \cite{PcaReq} and AADL/BLESS models.
	\item Analysis of different PCA pump implementation possibilities.
	\item AADL/BLESS to SPARK Ada translation schemes.
	\item Practical demonstration of SPARK 2005 and SPARK 2014 verification tools: its capabilities and limitations.
\end{itemize}


\section{Organization}
\label{introduction:organization}
This thesis is organized in \ref{future_work} [fix this: how to count all chapters?] chapters:
\begin{itemize}
	%\item Chapter \ref{introduction} is the problem description and summary of contribution which has been made.
	\item Chapter \ref{background} is Background that gives details about ICE, MDCF, Model-Driven Development, AADL, BLESS, SPARK Ada and available tools for such environment. 
	\item Chapter \ref{pcapump} describes Patient-Controlled Analgesia (PCA) pump.
	\item Chapter \ref{codegen} presents mappings from AADL/BLESS to SPARK Ada. 
	\item Chapter \ref{pcapumpimpl} describes the implementation of PCA Pump Prototype. Faced issues and design decisions made.
	\item Chapter \ref{verification} describes verification of implemented PCA Pump Prototype. 
	\item Chapter \ref{summary} summarizes all work which has been done in this thesis. 
	\item Chapter \ref{future_work} is the future work that can be done on this topic.
\end{itemize}


\section{Terms and Acronyms}
\label{introduction:terms}

\begin{itemize}
	\item \textbf{AADL} - Architecture Analysis \& Design Language
	\item \textbf{BLESS} - Behavioral Language for Embedded Systems with Software
	\item \textbf{ICE} - Integrated Clinical Environment
	\item \textbf{MDCF} - Medical Device Coordination Framework
	\item \textbf{PCA} - Patient-Controlled Analgesia (pump)
	\item \textbf{FDA} - Food and Drug Administration
	\item \textbf{GPS} - GNAT Programming Studio
	\item \textbf{GCC} - GNU Compiler Collection
	\item \textbf{GUI} - Graphical user interface
	\item \textbf{VC} - Verification Condition
	\item \textbf{DPC} - Dead Path Conjecture
	\item \textbf{POGS} - Proof Obligation Summarizer
	\item \textbf{VTBI} - Volume to be infused
	\item \textbf{KVO} - Keep Vein Open
\end{itemize}