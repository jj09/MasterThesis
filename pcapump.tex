%!TEX root = etdrtemplate.tex
% +--------------------------------------------------------------------+
% | Sample Chapter 3
% +--------------------------------------------------------------------+

\cleardoublepage

% +--------------------------------------------------------------------+
% | Replace "This is Chapter 3" below with the title of your chapter.
% | LaTeX will automatically number the chapters.
% +--------------------------------------------------------------------+

\chapter{PCA Pump Prototype}
\label{pcapump}

Overview of PCA Pump and issues, which MDCF/ICE will solve.
In this thesis, only the operation module is implemented.


\section{PCA Pump Requirements Document}
\label{pcapump:requirements-doc}
Selected use cases for implementation?
Overview of issues solved: 
* Bolus options: FBasal + FPatient or FPatient


\section{PCA Pump AADL/BLESS Models}
\label{pcapump:aadl-bless-models}
Selected modules for implementation. Pictures etc.


\section{BeagleBoard-XM}
\label{pcapump:beagleboard}
First step was create PCA Pump prototype on BeagleBoard-xM.

BeagleBoard-xM is Embedded device with AM37x 1GHz ARM processor (Cortex-A8 compatible). It has 512 MB RAM, 4 USB 2.0 ports, HDMI port, 28 General-purpose input/output (GPIO) ports and Linux Operating System (on microSD card). All these properties makes this device good candidate for prototyping PCA Pump.

Expansion port 14 and 28
GPIO158
Java Program to Run the pump for 10 seconds

There is no existing SPARK/Ada compiler running on ARM system. Hence, to compile SPARK/Ada program for ARM device, we need to perform cross-compilation on other machine. There is GNAT compiler \cite{Horn:Thesis} created by AdaCore, but there was no cross-compiler for ARM. However AdaCore was working on it. They had working version in 2013, but tested only on their target, Android-based device. BeagleBoard-xM is coming with Linux Angstrom Operating System. There is possibility to install Android on BeagleBoard-xM, but still not warranty everything will be working. Cooperation with AdaCore allowed to cross-compile SPARK/Ada program for BeagleBoard-xM.

Include source of simple program?
GNAT cross-compiler only for Linux Platform (cross-compilation has to be done on Linux).


\section{PCA Pump Prototype Implementation}
\label{pcapump:implementation}

Currently SPARK 2014 does not support tasking \cite{Spark2014refManual:Online}. For SPARK 2005, GNAT compiler provides Ravenscar Profile \cite{Ravenscar:Online}. It provides a subset of the tasking facilities of Ada95 and Ada 2005 suitable for the construction of high-integrity concurrent programs.

Issues: Ravenscar Profile, how to deal with different boluses (look at UMinn requirements and annotations for our doc).
Look at annotated PCA Pump Req document.

\subsection{Concurrency in SPARK}
\label{pcapump:implementation:concurrency}

Concurrent programs require the use of different specification and verification techniques from sequential programs. For this reason, tasks, protected units and objects, and synchronization features are currently excluded from SPARK 2014 \footnote{http://docs.adacore.com/spark2014-docs/html/lrm/tasks-and-synchronization.html} \cite{Spark2014refManual:Online}.

In SPARK 2005, concurrency is enable using the Ravenscar profile \cite{Ravenscar:Online}. 

\cite{Ravenscar:Article}

\subsection{Interface for Integrated Clinical Environment}
\label{pcapump:implementation:ice}

Describe communication with MDCF/ICE. PCA Pump ports for that etc.