%!TEX root = etdrtemplate.tex

\cleardoublepage


\chapter{PCA Pump}
\label{pcapump}

%http://www.santoslab.org/pub/paper/LarsonEtAl13-PCA-Requirements-SEHC-preprint.pdf
%http://ppahs.org/2012/05/30/patient-controlled-analgesia-pca-pumps-the-basics/
Description of PCA Pump, its functions, problems and how ICE can solve them.
Requirements document \cite{PcaReq}.
Requirements document overview \cite{OpenSourcePCAPump:Paper}.

In this thesis, only the operation module is implemented.


\begin{figure}[ht]%t=top, b=bottom, h=here
    \begin{center}
    	\includegraphics[height=3.5in]{figures/safety-critical-loop.png}
    	\caption{Basic Process Control Loop\protect\footnotemark.}
    \end{center}
\end{figure}
\footnotetext{http://www.safeware-eng.com/system and software safety publications/Designing Specification Languages.htm}

Pump internal implementation based on \cite{CADD-PrizmAmbulatoryInfusionPump:Online}.
- basal dose deliver in increments - easier to track delivered amount (page 14)



\section{PCA Pump Requirements Document}
\label{pcapump:requirements-doc}

Selected use cases for implementation?

%state machine image




\section{PCA Pump AADL/BLESS Models}
\label{pcapump:aadl-bless-models}
Selected modules for implementation. Pictures etc.



\section{BeagleBoard-XM}
\label{pcapump:beagleboard}
First step was create PCA Pump prototype on BeagleBoard-xM.

BeagleBoard-xM is Embedded device with AM37x 1GHz ARM processor (Cortex-A8 compatible). It has 512 MB RAM, 4 USB 2.0 ports, HDMI port, 28 General-purpose input/output (GPIO) ports and Linux Operating System (on microSD card). Moreover there is PWM support. All these properties makes this device good candidate for prototyping PCA Pump.

Pulse width modulation (PWM) is a technique for controlling analog circuits with a processor's digital outputs.

Expansion port 14(PWM) and 28(GND?)
GPIO158
Java Program to Run the pump for 10 seconds

There is no existing SPARK Ada compiler running on ARM system. Hence, to compile SPARK Ada program for ARM device, we need to perform cross-compilation on other machine. There is GNAT compiler \cite{Horn:Thesis} created by AdaCore, but there was no cross-compiler for ARM. However AdaCore was working on it. They had working version in 2013, but tested only on their target, Android-based device. BeagleBoard-xM is coming with Linux Angstrom Operating System. There is possibility to install Android on BeagleBoard-xM, but still not warranty everything will be working. Cooperation with AdaCore allowed to cross-compile SPARK Ada program for BeagleBoard-xM.

Include source of simple program?
GNAT cross-compiler only for Linux Platform (cross-compilation has to be done on Linux).

compilation+linking command: \lstinline{arm-linux-gnueabi-gnatmake -d -Ppca_ravenscar.gpr}.

%describe how to run the program: compile cmd with arm-gnuaebi... then copy to the board etc.



\section{Interface for Integrated Clinical Environment}
\label{pcapump:implementation:ice}

PCA Pump will be connected to ICE. It will allow to monitor and control device by MDCF (ICE implementation).
Describe communication with MDCF/ICE. PCA Pump ports for that etc.