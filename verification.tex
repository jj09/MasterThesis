%!TEX root = etdrtemplate.tex
% +--------------------------------------------------------------------+
% | Chapter 6
% +--------------------------------------------------------------------+

\cleardoublepage

\chapter{Verification}
\label{verification}

Verification



\section{SPARK Examiner}

The main SPARK verification tool is Examiner. It supports several levels of analysis:
\begin{itemize}
	\item checking of SPARK language syntactic and static semantic rules
	\item data flow analysis
	\item data and information flow analysis
	\item formal program verification via generation of verification conditions
	\item proof of absence of run-time errors
	\item dead path analysis
\end{itemize}

There is also an option to make the Examiner perform syntax checks only. Using this option on a source file does not require access to any other units on which the file depends, so files can be syntax checked on an individual basis. This allows any syntax errors to be corrected before the file is included in a complex examination.  This option must only be used as a pre-processor: the absence of syntax errors does NOT indicate that the source text is a legal SPARK program. \cite{Examiner:Online} (THIS PART IS COPY AND PASTE FROM Examiner doc - is it ok?)

Put here some examples: method without contract, examine, add specification, pass Examiner.

During implementation, code was regularly checked using SPARK Examiner.

What is very important, Examiner can perform data and information analysis of Ravenscar programs in exactly the same manner as for sequential programs \cite{Ravenscar:Online}. Unfortunately it does not allow protected objects in proof annotations (pre- and post-conditions).

To generate verification conditions (VCs), the \lstinline{-vcg} switch has to be used. It can be set in GNAT Programming Studio (Project / Edit project properties / Switches / Examiner / Generate VCs).


\subsection{SPARK Simplifier}

Simplifier can discharge (prove correctness) of verification conditions (VCs) generated by Examiner, but not proved by Examiner. \cite{Simplifier:Online} 


\subsection{Proof Obligation Summarizer (POGS)}

The Proof ObliGation Summarizer tool (POGS) reads and understands the structure of the verification condition files. It reports of the status of proofs and dead path analyses in a human-readable form. \cite{POGS:Online}


\subsection{Example verification}

On Odometer or RateController of PCA Pump?

\subsection{Verification of PCA Pump}

Examine(F8) -> Simplifier --> POGS.

4 warnings:
Warning 402 - Default assertion planted to cut loop.

solution:
--# assert I > 1 -> TheStoredData(I-1) = TheStoredData(I);
--# assert I > 1 -> Result >= TheStoredData(I-1);
--# assert true; // add BLESS assertions? then resolve warning 402?
--# assert true; // add BLESS assertions? then resolve warning 402?




\section{AUnit tests}
- test incrementing array
- test moving array (Pulse does not change dosed amount)
- test prescription setters and getters
- test state machine
	* change to bolus mode
	* change to KVO rate
	* etc.



\section{gnatPROVE?}

There is a new tool set "gnatPROVE" for SPARK 2014. It was not used because PCA Pump was developed in SPARK 2005.
I CAN TRANSLATE SOME SINGLE FUNCTIONS AND USE GNAT PROVE TO VERIFY?
